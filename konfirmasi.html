<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Konfirmasi Registrasi</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.lordicon.com/lordicon.js"></script>

  <script type="module">
    import { db } from '/firebase.js';
    import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const params = new URLSearchParams(location.search);
    const id = params.get('id');

    const namaEl = document.getElementById('nama');
    const btnConfirm = document.getElementById('btnConfirm');

    async function load(){
      const snap = await getDoc(doc(db,'peserta',id));
      if(!snap.exists()) return alert("Peserta tidak ditemukan.");

      const p = snap.data();
      namaEl.textContent = p.nama || "-";
    }
    load();

    btnConfirm.onclick = async () => {
      btnConfirm.disabled = true;
      btnConfirm.textContent = "Mengonfirmasi...";

      await setDoc(doc(db,'peserta',id), {
        registered: true,
        registeredAt: new Date().toISOString()
      }, { merge:true });

      location.href = `/success?id=${id}`;
    };
  </script>
</head>

<body class="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 flex items-center justify-center p-6">

  <div class="w-full max-w-md bg-white/70 backdrop-blur-xl shadow-2xl rounded-2xl overflow-hidden border border-white/40">

    <!-- Header -->
    <div class="bg-gradient-to-r from-green-600 to-emerald-500 text-white p-6 text-center">
      <h1 class="text-2xl font-bold">Konfirmasi Registrasi</h1>
      <p class="text-sm opacity-90 mt-1">Pastikan data sesuai sebelum memverifikasi.</p>
    </div>

    <!-- Content -->
    <div class="p-6 flex flex-col items-center">

      <lord-icon
        src="https://cdn.lordicon.com/ajkxzzfb.json"
        trigger="loop"
        colors="primary:#10b981"
        style="width:100px;height:100px">
      </lord-icon>

      <p class="text-lg text-gray-700 mt-4">Nama Peserta:</p>
      <p id="nama" class="text-2xl font-bold text-green-700 mt-1 tracking-wide">
        Memuat...
      </p>

      <button id="btnConfirm"
        class="mt-6 w-full bg-green-600 hover:bg-green-700 active:scale-95 text-white py-3 rounded-xl font-semibold shadow-lg transition-all duration-200">
        Konfirmasi Sekarang
      </button>

      <a href="/admin"
        class="mt-3 text-sm text-gray-600 hover:text-gray-800 transition">
        ‚Üê Kembali ke Dashboard
      </a>

    </div>
  </div>

</body>
</html>
